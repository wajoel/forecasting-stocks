# main.R

# Load and source functions
source("simulate_stock_data.R")
source("preprocess_stock_data.R")
source("plot_stock_prices.R")
source("fit_arima_model.R")
source("forecast_arima.R")
source("fit_ets_model.R")
source("forecast_ets.R")
source("evaluate_forecast.R")
source("visualize_forecasts.R")
source("save_forecast_results.R")

# Step 1: Simulate data
stock_data <- simulate_stock_data()

# Step 2: Preprocess data
clean_data <- preprocess_stock_data(stock_data)

# Step 3: Plot historical data
plot_stock_prices(clean_data)

# Step 4: Fit ARIMA and ETS models
arima_model <- fit_arima_model(clean_data)
ets_model <- fit_ets_model(clean_data)

# Step 5: Generate forecasts
arima_forecast <- forecast_arima(arima_model, h = 30)
ets_forecast <- forecast_ets(ets_model, h = 30)

# Step 6: Visualize forecasts
visualize_forecasts(clean_data, arima_forecast, "ARIMA Forecast vs Actual")
visualize_forecasts(clean_data, ets_forecast, "ETS Forecast vs Actual")

# Step 7: Evaluate forecasts (using simulated future data)
# Simulate actual future data for evaluation
future_data <- simulate_stock_data(days = 30, start_price = tail(clean_data$Price, 1))
arima_eval <- evaluate_forecast(future_data$Price, arima_forecast$mean)
ets_eval <- evaluate_forecast(future_data$Price, ets_forecast$mean)

# Step 8: Save results
save_forecast_results(arima_forecast, "arima_forecast_results.csv")
save_forecast_results(ets_forecast, "ets_forecast_results.csv")

# Print evaluation metrics
print(paste("ARIMA RMSE:", arima_eval$RMSE, "MAE:", arima_eval$MAE))
print(paste("ETS RMSE:", ets_eval$RMSE, "MAE:", ets_eval$MAE))
